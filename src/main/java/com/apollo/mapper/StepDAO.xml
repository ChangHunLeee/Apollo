<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.apollo.step.dao.StepDAO">
    <select id="getSteps" parameterType="String" resultType="com.apollo.vo.StepDTO">
    select * from step where pid = #{pid}
    </select>

	<insert id="insertStep" parameterType="com.apollo.vo.StepDTO">
		insert into step(sid, sname, sday, eday, pid, fid, methodologyid, mid, detail) 
		values (seq_sid.nextval, #{sname}, #{sday}, #{eday}, #{pid}, #{fid}, #{methodologyid}, #{mid}, #{detail})
	</insert>

	<select id ="getProjectIdByStepId" parameterType="Integer" resultType="Integer"> 
	 	select pid from step where sid=#{sid}
	</select>
	
    <select id ="selectTstatusBySid" resultType="com.apollo.vo.TstatusDTO" parameterType="Integer"> 
    	select ts.TSTATUS, ts.TSTATUSID, ts.COLOR from step s join TSTATUS ts on s.METHODOLOGYID = ts.METHODOLOGYID where sid=#{sid}
	</select>

	<select id="selectStepList" parameterType="java.util.List" resultType="com.apollo.vo.StepDTO">
		select sid, sname, sday, eday, pid, fid, methodologyid, mid, detail from step
		where pid in 
		<foreach collection="list" item="pid"  open="(" close=")" separator=",">
            #{pid}
        </foreach>
	</select>

	<select id="getStepsid" parameterType="String" resultType="com.apollo.vo.StepDTO">
   	 select * from step where sid in (select sid from taskinstep where tid = #{tid})
    </select>
    
	<select id="selectStep" resultType="com.apollo.vo.StepDTO">
		select * from step where sid=#{sid}
	</select>
	
	<update id="updateStep" parameterType="com.apollo.vo.StepDTO">
		update step set
		<if test="sname != null">sname=#{sname},</if>
		<if test="mid != null">mid=#{mid},</if>
		<if test="sday != null">sday=#{sday},</if>
		<if test="eday != null">eday=#{eday},</if>
		<if test="methodologyid != 0">methodologyid=#{methodologyid},</if>
		<if test="pid != 0">pid=#{pid},</if>
		<if test="fid != null">fid=#{fid},</if>
		<if test="detail != null">detail=#{detail}</if>
		where sid=#{sid}
	</update>
	
	<update id="moveStep" parameterType="com.apollo.vo.StepDTO" >
		update step set fid=#{fid} where sid=#{sid}
	</update>
</mapper>