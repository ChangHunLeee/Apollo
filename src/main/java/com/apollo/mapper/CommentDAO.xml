<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.apollo.inbox.dao.InboxDAO">
<select id="getCommentlist" parameterType="String" resultType="com.apollo.vo.CommentDTO">
SELECT r.cmtid, c.comments, c.tid, c.mid ,m.mname, c.cmtkind, c.cmtmtime, r.isarchive, t.tname, p.pname,m.image
 FROM RECEIVER r JOIN COMMENTS c ON r.CMTID = c.CMTID join task t on t.tid=c.tid join project p on p.pid =t.pid 
 join member m on c.mid = m.mid where r.mid=#{mid} and r.ISARCHIVE = 0 and (r.mid != c.mid or cmtkind = 2) ORDER BY c.cmtmtime DESC
</select>

<select id="getSentlist" parameterType="String" resultType="com.apollo.vo.CommentDTO">
 SELECT r.cmtid, c.comments, c.tid, c.mid ,m.mname, c.cmtkind, c.cmtmtime, r.isarchive, t.tname, p.pname,m.image
 FROM RECEIVER r JOIN COMMENTS c ON r.CMTID = c.CMTID join task t on t.tid=c.tid join project p on p.pid =t.pid 
 join member m on c.mid = m.mid where r.mid=#{mid} and r.ISARCHIVE = 0 and r.mid = c.mid and cmtkind = 0 ORDER BY c.cmtmtime DESC
</select>

<select id="getArchivelist" parameterType="String" resultType="com.apollo.vo.CommentDTO">
  SELECT r.cmtid, c.comments, c.tid, c.mid ,m.mname, c.cmtkind, c.cmtmtime, r.isarchive, t.tname, p.pname,m.image
 FROM RECEIVER r JOIN COMMENTS c ON r.CMTID = c.CMTID join task t on t.tid=c.tid join project p on p.pid =t.pid 
 join member m on c.mid = m.mid where r.mid=#{mid} and r.ISARCHIVE = 1 and (cmtkind = 0 or cmtkind = 2) ORDER BY c.cmtmtime DESC
</select>

<update id="updateArchive" parameterType="com.apollo.vo.CommentDTO">
UPDATE RECEIVER SET ISARCHIVE = 1 where mid=#{mid} and cmtid=#{cmtid}
</update>

<update id="updateArchive2" parameterType="com.apollo.vo.CommentDTO">
UPDATE RECEIVER SET ISARCHIVE = 0 where mid=#{mid} and cmtid=#{cmtid}
</update>

<select id="getCommentsAndMember" parameterType="Integer" resultType="com.apollo.vo.CommentAndMemberDTO">
	select * from comments, member where comments.mid = member.mid and tid = #{tid} order by comments.cmtmtime asc
</select>



</mapper>